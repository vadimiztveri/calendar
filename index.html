<!DOCTYPE html>
<html>
  <head>
    <title>Всплывающий календарь</title>
    <meta http-equiv="Content-Language" content="ru">
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">

    <style>
	  html{font-family:sans-serif;color:#555555;}
	  button{font-size:200%;padding:10 20px;}

	  div.calender{border:4px solid #777777;border-radius:4px;width:300px;margin:20px 0 20px 0;}
      #year, #month{border-bottom:1px solid #ccc;width:300px;text-align:center;}
	  #year a, #month a{font-size:70%;color:#aaa;text-decoration:none;cursor:pointer;}
	  ul.week-days{display:block;width:300px;background:#555;color:#fff;overflow:hidden;padding:0;}
	  ul.week-days li{display:block;float:left;width:42px;margin:0;padding:0;text-align:center;}
	  ul.week-days li.weekend{color:#ff5555;}

	  #days{display:block;width:300px;overflow:hidden;padding:0;}
	  #days li{display:block;float:left;width:42px;margin:0;padding:0;text-align:right;border-bottom:1px solid #ccc;}
	  #days li.empty{border:none;}
	  #days li.weekend{color:#ff5555;}
	  #days li a{display:block;width:38px;padding:0 4px 0 0;cursor:pointer;}
	  #days li a:hover{text-decoration:underline;}

	</style>

  </head>
  <body onload="start_new_calendar()">
	<h1>Всплывающий календарь</h1>
	
	<button>Новая дата</button>
	
	<div class="calender">
	  <div id="year"></div>
      <div id="month"></div>
	  <ul class="week-days">
	      <li>Пн</li>
	      <li>Вт</li>
	      <li>Ср</li>
	      <li>Чт</li>
	      <li>Пт</li>
	      <li class="weekend">Сб</li>
	      <li class="weekend">Вс</li>
	  </ul>
	  <ul id="days">
	  </ul>
	</div>

	<input id="result" autofocus>


	<script type="text/javascript">
      
     /**
      * Основные данные, с которыми работает календарь.
      * При запуске получает текущую дату, прикаждом дейтвии пользователя сюда записывается новая дата.
      *
      * new_date.day - число
      * new_date.month - месяц
      * new_date.year - год
      *
      * Да, я капитан Очевидность. Но пусть хоть какой-нибудь программист потом скажет, что чего-то не понимает в моем коде.
      */
      var new_date = {
        date : new Date(),
        day : new Date().getDate(),
        month : new Date().getMonth(),
        year : new Date().getFullYear()
      }
      
     /**
      * Запускает прорисовку нового календаря.
      * Дату месяца берет из конфигурационных файлов.
      * Не получает и возвращает данные.
      */
      var start_new_calendar = function(){
        draw_new_table(new_date.month, new_date.year);
        var id_block_date_now = "date" + new_date.day;
        document.getElementById(id_block_date_now).style.background = "#ccc";
        display_full_date();
      }

     /**
      * Получает новое число из даты, запускает функцию отображения смены даты.
      *
      * @example
      * change_day(3);
      *
      * @param {Number} number число даты, от 1 до 31 (например: 3).
      * Не возвращает значений.
      */
      var change_day = function(number) {
        var old_day = new_date.day;
        new_date.day = number;
        change_day_in_calendar(old_day, new_date.day)
      }
      
     /**
      * Получает старое число и новое число из даты и сменяет отображение в календаре
      *
      * @example
      * change_day_in_calendar(13, 3);
      *
      * @param {Number} old_day число даты, от 1 до 31 (например: 3).
      * @param {Number} new_day число даты, от 1 до 31 (например: 13).
      * Не возвращает значений.
      */
      var change_day_in_calendar = function(old_day, new_day) {
        display_full_date();
        var id_old = "date" + old_day;
        document.getElementById(id_old).style.background = 'transparent';
        var id_new = "date" + new_day;
        document.getElementById(id_new).style.background = '#ccc';
      }

     /**
      * Выводит на экран дату текстом под таблицей.
      * Не получает и не возвращает значений. Дату берет из конфигурационных значений.
      */
      var display_full_date = function(){
        var month_case = ["января", "февраля", "марта", "апреля", "мая", "июня", "июля", "августа", "сентября", "октября", "ноября", "декабря"];
        document.getElementById('result').value = new_date.day + " " + month_case[(new_date.month)] + " " + new_date.year;
      }
      
     /**
      * Перерисовывает целиком табличку с календарем
      *
      * @example
      * get_week_day(9, 2013); // return 4
      *
      * @param {Number} month номер месяца, от 0 до 11 (например: 9).
      * @param {Number} year год (например: 2013).
      * Не возвращает значений. Дату берет из new_date.
      */
      var draw_new_table = function(month, year) {

        var text_year = "<a onclick='chance_year(-1)' id='year-minus'>" + (new_date.year - 1) + "&nbsp;←</a> " + new_date.year + " <a onclick='chance_year(1)' id='year-plus'>→&nbsp;" + (new_date.year + 1) + "</a>";
        document.getElementById('year').innerHTML = text_year;
        
        var month = ["Декабрь", "Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь", "Январь"];
        var text_month = "<a onclick='chance_month(-1)' id='month-minus'>" + month[new_date.month] + "&nbsp;←</a> " + month[new_date.month+1] + " <a onclick='chance_month(1)' id='month-plus'>→&nbsp;" + month[new_date.month + 2] + "</a>";
        document.getElementById('month').innerHTML = text_month;

        var text_days = "";
        for (i = 0;i < (get_week_day_of_first_day() + get_all_days_in_month());i++) {
          if (i < get_week_day_of_first_day()){
            text_days = text_days + "<li class='empty'>&nbsp;</li>";
          } else {
            var day = i - get_week_day_of_first_day() + 1;
            if (i % 7 === 5 || i % 7 === 6) {
              text_days = text_days + "<li class='weekend'><a id='date" + day + "' onclick='change_day(" + day + ")'>" + day + "</a></li>";
            } else {
              text_days = text_days + "<li><a id='date" + day + "' onclick='change_day(" + day + ")'>" + day + "</a></li>";
            }
          }
        }
        document.getElementById('days').innerHTML = text_days;
      }
      
     /**
      * Возвращает день недели первого числа определенного числа месяца и года.
      *
      * @example
      * get_week_day(9, 2013); // return 1
      *
      * @param {Number} month номер месяца, от 0 до 11 (например: 9).
      * @param {Number} year год (например: 2013).
      * @returns {Number} день недели числом от 0 до 6, понедельник 0, вторник 1... воскресенье 6 (например, 1)
      */
      var get_week_day_of_first_day = function() {
        var date = new Date(new_date.year, new_date.month, 1);
        var week_day = date.getDay() - 1;
        if (week_day === -1) {week_day = 6;}
        return week_day;
      }

     /**
      * Возвращает количество дней в месяце.
      *
      * @example
      * get_days_in_month(9, 2013); // return 31
      *
      * @param {Number} month номер месяца, от 0 до 11 (например: 9).
      * @param {Number} year год (например: 2013).
      * @returns {Number} количество дней (например, 31)
      */
      var get_all_days_in_month = function(){
        var days_in_month = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
        var all_days = days_in_month[new_date.month];
        if (new_date.year % 4 === 0 && new_date.month === 1){all_days = 29;}
        return all_days;
      }
      
     /**
      * Прибавляет или вычитает 1 год и вызывает функции отображения календаря и даты текстом
      *
      * @example
      * chance_year(-1);
      *
      * @param {Number} count или 1, или -1 (например: -1).

      * Не возвращает данные.
      */
      var chance_year = function(count){
        new_date.year = new_date.year + count;
        draw_new_table(new_date.month, new_date.year);
        display_full_date();
      }

     /**
      * Прибавляет или вычитает 1 месяц и вызывает функции отображения календаря и даты текстом
      *
      * @example
      * chance_month(-1);
      *
      * @param {Number} count или 1, или -1 (например: -1).

      * Не возвращает данные.
      */
      var chance_month = function(count){
        new_date.month = new_date.month + count;
        if (new_date.month === 12) {
          new_date.month = 0;
          new_date.year++;
        }
        if (new_date.month === -1) {
          new_date.month = 11;
          new_date.year--;
        }
        draw_new_table(new_date.month, new_date.year);
        display_full_date();
      }
      
      


      
	</script>

  </body>
</html>